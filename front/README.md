# 개인비서 Assistant 프론트엔드

Google Cloud Speech-to-Text와 Text-to-Speech API를 활용한 실시간 개인비서 음성 인터페이스입니다.

## 📁 파일 구조

```
front/
├── assets/
│   ├── css/                    # 스타일시트 파일들
│   │   ├── base.css           # 기본 레이아웃 및 컨테이너 스타일
│   │   ├── animations.css     # 모든 애니메이션 정의
│   │   ├── dots.css          # 점들 관련 스타일과 상태별 애니메이션
│   │   ├── button.css        # 마이크 버튼 스타일
│   │   └── effects.css       # 배경 시스템 효과
│   └── js/                    # JavaScript 파일들
│       ├── config.js         # 설정값과 상수 정의
│       ├── audio-manager.js  # 오디오 녹음/재생 관리
│       ├── dots-manager.js   # 점들 생성과 상태 관리
│       ├── api-client.js     # 서버 통신 관리
│       ├── ui-controller.js  # UI 상태 관리와 이벤트 처리
│       └── voice-chatbot.js  # 메인 음성 챗봇 클래스
├── page_list/
│   └── voice_chatbot_page.py # Streamlit 페이지 구현
├── ENV_CONFIG.md             # 환경변수 설정 가이드
└── README.md                 # 이 파일
```

## 🎯 주요 기능

### 🎤 음성 인식 (STT)
- Google Cloud Speech-to-Text API 사용
- 실시간 음성 감지 및 자동 녹음 중지
- 한국어 음성 인식 지원
- WAV 형식 오디오 처리

### 🤖 개인비서 연동
- 외부 개인비서 서버와 REST API 통신
- 다양한 비서 모드 지원 (일반 상담, 일정 관리, 메모 관리, 건강 관리)
- 세션 관리 기능

### 🔊 음성 합성 (TTS)
- Google Cloud Text-to-Speech API 사용
- 고품질 한국어 음성 (Chirp3-HD)
- 기본 음성으로 자동 폴백

### 🎨 시각적 피드백
- 상태별 파도 애니메이션 (대기, 듣기, 처리중, 재생중)
- 부드러운 상태 전환 효과
- 호흡 애니메이션
- 색상 기반 상태 표시

## 🏗️ 아키텍처

### 모듈 구조
```
VoiceAssistant (메인 클래스)
├── AudioManager      # 오디오 녹음/재생
├── WaveManager       # 시각적 피드백
├── ApiClient         # 서버 통신
└── UIController      # UI 상태 관리
```

### 데이터 흐름
```
1. 사용자 음성 입력
   ↓
2. AudioManager → 녹음 및 WAV 변환
   ↓
3. ApiClient → STT 서버 전송
   ↓
4. ApiClient → 챗봇 서버 전송
   ↓
5. ApiClient → TTS 서버 전송
   ↓
6. AudioManager → 오디오 재생
```

## ⚙️ 설정

모든 설정은 `assets/js/config.js` 파일에서 관리됩니다.

### 주요 설정 항목
- **서버 URL**: STT, TTS, 챗봇 서버 주소
- **오디오 설정**: 샘플링 레이트, 채널, 음성 감지 임계값
- **시각화 설정**: 점 개수, 크기, 색상, 애니메이션 속도
- **디버그 설정**: 로그 레벨, API 응답 로깅

자세한 설정 방법은 [ENV_CONFIG.md](ENV_CONFIG.md)를 참조하세요.

## 🚀 사용법

### 1. 서버 준비
```bash
# STT/TTS 서버 시작 (포트 8504)
cd voice-back
python voice_server.py

# 챗봇 서버 시작 (포트 8800)
cd chatbot-server
python app.py
```

### 2. Streamlit 앱 실행
```bash
cd front
streamlit run main.py
```

### 3. 음성 채팅 사용
1. 마이크 버튼 클릭
2. 음성 입력 (자동으로 녹음 중지)
3. STT → 챗봇 → TTS 처리 대기
4. 응답 음성 재생

## 🎨 상태별 시각적 피드백

| 상태 | 색상 | 애니메이션 | 설명 |
|------|------|------------|------|
| **IDLE** | 파란색 (#4A90E2) | 호흡 애니메이션 | 대기 상태 |
| **LISTENING** | 청록색 (#50E3C2) | 확장 애니메이션 | 음성 입력 중 |
| **PROCESSING** | 주황색 (#F5A623) | 회전 애니메이션 | 처리 중 |
| **TTS_PLAYING** | 보라색 (#BD10E0) | 파도 애니메이션 | 음성 재생 중 |

## 🔧 개발 가이드

### 새로운 기능 추가
1. 해당 모듈 클래스에 메서드 추가
2. `config.js`에 필요한 설정 추가
3. 상태가 필요하면 `STATES`에 추가
4. CSS 애니메이션이 필요하면 해당 CSS 파일에 추가

### 디버깅
브라우저 개발자 도구 콘솔에서:
```javascript
// 현재 설정 확인
console.log(CONFIG);

// 음성 챗봇 인스턴스 접근
console.log(voiceChatbot);
```

### 스타일 수정
- `base.css`: 기본 레이아웃
- `animations.css`: 애니메이션 효과
- `dots.css`: 점들 스타일
- `button.css`: 버튼 스타일
- `effects.css`: 배경 효과

## 🐛 문제 해결

### 일반적인 문제
1. **마이크 권한 오류**: 브라우저에서 마이크 권한 허용
2. **서버 연결 오류**: 서버 URL과 포트 확인
3. **음성 인식 실패**: 마이크 입력 레벨 확인
4. **TTS 재생 안됨**: 브라우저 오디오 정책 확인

### 로그 확인
```javascript
// 디버그 모드 활성화
CONFIG.DEBUG.ENABLED = true;
CONFIG.DEBUG.LOG_API_RESPONSES = true;
```

## 🔄 에이전트 핸드오프 테스트

개인비서 시스템은 4개의 전문 에이전트가 서로 협력하여 작업합니다. 다음 질문들로 에이전트 간 핸드오프를 테스트해보세요:

### 🎯 기본 핸드오프 테스트

#### 일반상담 → 일정관리
```
"내일 오후 3시에 병원 예약을 잡아줘"
"다음 주 월요일에 회의 일정이 있나?"
"이번 달 일정을 정리해서 보여줘"
```

#### 일반상담 → 메모관리
```
"오늘 있었던 중요한 일들을 메모해줘"
"회의록을 작성해야 하는데 도와줘"
"할일 목록을 만들어 관리하고 싶어"
```

#### 일반상담 → 건강관리
```
"운동 계획을 세워줘"
"다이어트를 시작하려고 하는데 도움이 필요해"
"건강 목표를 설정하고 관리하고 싶어"
```

### 🔀 역방향 핸드오프 테스트

#### 일정관리 → 다른 에이전트
```
"운동 일정을 잡았는데, 구체적인 운동 계획도 세워줘" (→ 건강관리)
"회의가 끝나면 회의록을 작성해야 하는데..." (→ 메모관리)
"일정이 너무 복잡해서 간단한 질문 하나만 할게" (→ 일반상담)
```

#### 건강관리 → 다른 에이전트
```
"운동 계획을 세웠으니 운동 일정도 캘린더에 추가해줘" (→ 일정관리)
"운동 기록을 메모로 남기고 싶어" (→ 메모관리)
"운동 외에 다른 건강한 생활습관도 알려줘" (→ 일반상담)
```

#### 메모관리 → 다른 에이전트
```
"메모한 할일들을 일정으로 만들어줘" (→ 일정관리)
"건강 관련 메모를 전문적으로 관리하고 싶어" (→ 건강관리)
"메모 정리 방법에 대해 일반적인 조언을 받고 싶어" (→ 일반상담)
```

### 🎪 복합 요청 테스트 (자동 핸드오프)

#### 다중 에이전트 협업
```
"다음 주부터 다이어트를 시작하려고 해. 운동 계획도 세우고, 일정도 잡고, 진행 상황을 메모로 관리하고 싶어"

"새 프로젝트를 시작하는데, 일정 관리, 할일 정리, 건강도 챙기면서 진행하고 싶어"

"건강 검진 예약을 잡고, 검진 전 준비사항을 메모해두고, 건강 목표도 새로 설정하고 싶어"
```

#### 연쇄 핸드오프
```
"아침 운동 루틴을 만들어서, 매일 아침 일정에 넣고, 운동 후 간단한 기록을 남기고 싶어"

"회의가 있는 날에는 운동 시간을 조정하고, 회의록도 작성하고, 전반적인 스케줄 관리를 받고 싶어"
```

### ✅ 핸드오프 성공 확인 방법

1. **에이전트 전환 메시지**: "○○ 에이전트로 연결합니다" 또는 "○○ 전문 담당자가 도와드리겠습니다"
2. **전문성 확인**: 각 에이전트의 전문 용어와 접근 방식 차이
3. **도구 사용**: 각 에이전트가 해당 MCP 서버의 도구들을 활용하는지 확인
4. **연계 제안**: 다른 에이전트의 도움이 필요할 때 자연스러운 연결 제안

### 🚨 핸드오프 실패 시 대처

만약 핸드오프가 제대로 작동하지 않는다면:

1. **직접 모드 변경**: 사이드바에서 에이전트 모드를 직접 선택
2. **명시적 요청**: "일정관리 전문가에게 물어보고 싶어" 처럼 명확하게 요청
3. **재시도**: 다른 표현으로 동일한 요청을 다시 해보기

### 🎨 테스트 모범 사례

- **구체적 요청**: "운동하고 싶어" 보다는 "주 3회 홈트레이닝 계획을 세워줘"
- **맥락 제공**: "회사원이고 저녁 시간에만 운동 가능해"
- **단계적 접근**: 복잡한 요청은 단계별로 나누어 테스트
- **인내심**: AI가 에이전트를 선택하고 전환하는데 몇 초 소요될 수 있음

## 📝 라이센스

이 프로젝트는 MIT 라이센스 하에 배포됩니다. 